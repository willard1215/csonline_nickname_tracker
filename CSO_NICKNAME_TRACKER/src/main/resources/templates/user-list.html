
<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8"/>
    <title>CSO Nickname Tracker - 유저 목록</title>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>

    <!-- Bootstrap -->
    <link rel="stylesheet"
          href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"/>

    <style>
        body {
            background: radial-gradient(circle at top, #2a2a2a 0, #111 55%, #050505 100%);
            color: #f5f5f5;
            font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
        }

        a {
            text-decoration: none;
        }

        .navbar {
            background-color: #161616;
            border-bottom: 1px solid #2c2c2c;
        }

        .navbar-brand {
            font-weight: 600;
            letter-spacing: 0.03em;
        }

        .main-card {
            background: rgba(18, 18, 18, 0.95);
            border-radius: 16px;
            border: 1px solid #262626;
            box-shadow:
                    0 18px 40px rgba(0, 0, 0, 0.7),
                    0 0 0 1px rgba(255, 255, 255, 0.02);
            padding: 20px 22px;
        }

        .table thead {
            background: #181818;
        }

        .table thead th {
            border-bottom-width: 1px;
            border-color: #303030 !important;
            color: #b8b8b8;
            font-weight: 500;
            font-size: 0.9rem;
        }

        .table tbody td {
            border-color: #252525 !important;
            vertical-align: middle;
        }

        .table-striped > tbody > tr:nth-of-type(odd) {
            --bs-table-accent-bg: #171717;
        }

        .table-hover tbody tr:hover {
            background-color: #222 !important;
        }

        .idx-cell {
            color: #8b8b8b;
            font-size: 0.85rem;
        }

        .nickname-cell {
            font-weight: 500;
            font-size: 0.95rem;
        }

        .nickname-cell span {
            display: inline-flex;
            align-items: center;
            gap: 6px;
        }

        .nickname-tag {
            padding: 2px 8px;
            border-radius: 999px;
            background: rgba(255, 85, 85, 0.15);
            color: #ff8080;
            font-size: 0.7rem;
            text-transform: uppercase;
            letter-spacing: 0.08em;
        }

        .badge-sn {
            font-family: "JetBrains Mono", ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
            font-size: 0.8rem;
            background: #212121;
            border: 1px solid #333;
        }

        .badge-sn a {
            color: #d0d0d0;
        }

        .badge-sn a:hover {
            color: #ffffff;
        }

        .page-link {
            background-color: #181818;
            border-color: #303030;
            color: #e0e0e0;
            font-size: 0.85rem;
        }

        .page-link:hover {
            background-color: #262626;
            color: #ffffff;
        }

        .page-item.active .page-link {
            background-color: #ff5555;
            border-color: #ff5555;
            color: #fff;
        }

        .page-item.disabled .page-link {
            background-color: #101010;
            border-color: #202020;
            color: #555;
        }

        .summary-text {
            font-size: 0.85rem;
            color: #a0a0a0;
        }

        .size-select {
            width: auto;
            min-width: 90px;
        }

        .size-select select {
            background-color: #111;
            color: #f5f5f5;
            border-color: #333;
        }

        .size-select select:focus {
            box-shadow: 0 0 0 0.15rem rgba(255, 85, 85, 0.35);
        }

        .divider {
            border-bottom: 1px solid #262626;
            margin: 12px 0 16px;
        }
    </style>
</head>
<body>

<nav class="navbar navbar-dark mb-4">
    <div class="container-fluid">
        <span class="navbar-brand mb-0 h1">
            CSO Nickname Tracker
        </span>
    </div>
</nav>

<div class="container mb-5">

    <div class="row justify-content-center">
        <div class="col-12 col-lg-10 col-xxl-9">

            <div class="main-card">

                <!-- 헤더 / 요약 / size 변경 -->
                <div class="d-flex flex-wrap justify-content-between align-items-center gap-3">
                    <div>
                        <h4 class="mb-1">비매너 유저 목록</h4>
                        <div class="summary-text"
                             th:text="'총 ' + ${totalUsers} + '명 · 페이지 ' + (${pageNumber}+1) + ' / ' + (${totalPages} == 0 ? 1 : ${totalPages})">
                            총 0명 · 페이지 1 / 1
                        </div>
                    </div>

                    <!-- size 변경 폼 -->
                    <form th:action="@{/getUser}" method="get" id="sizeForm"
                          class="d-flex align-items-center gap-2 size-select">
                        <input type="hidden" name="page" th:value="${pageNumber}"/>

                        <label for="sizeSelect" class="form-label mb-0">페이지 크기</label>
                        <select id="sizeSelect" name="size"
                                class="form-select form-select-sm"
                                th:value="${size}"
                                onchange="document.getElementById('sizeForm').submit()">
                            <option th:value="10"
                                    th:selected="${size == 10}">10개</option>
                            <option th:value="20"
                                    th:selected="${size == 20}">20개</option>
                            <option th:value="50"
                                    th:selected="${size == 50}">50개</option>
                            <option th:value="100"
                                    th:selected="${size == 100}">100개</option>
                        </select>
                    </form>
                    <!-- BanList.lua 다운로드 버튼 -->
                    <a th:href="@{/banlist.lua}"
                       class="btn btn-sm btn-outline-danger">
                        BanList.lua 다운로드
                    </a>
                </div>

                <div class="divider"></div>

                <!-- 유저 테이블 -->
                <div class="table-responsive">
                    <table class="table table-dark table-striped table-hover align-middle mb-2">
                        <thead>
                        <tr>
                            <th scope="col" style="width: 70px;">#</th>
                            <th scope="col">닉네임</th>
                            <th scope="col" style="width: 320px;">Nexon SN / 전적 링크</th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr th:if="${#lists.isEmpty(users)}">
                            <td colspan="3" class="text-center text-secondary py-4">
                                등록된 유저가 없습니다.
                            </td>
                        </tr>

                        <tr th:each="user, stat : ${users}">
                            <!-- 전역 인덱스: (pageNumber * size) + stat.index + 1 -->
                            <td class="idx-cell"
                                th:text="${pageNumber * size + stat.index + 1}">1</td>

                            <td class="nickname-cell">
                                <span>
                                    <a th:href="@{/user/history(userKey=${user.userKey})}"
                                       th:text="${user.nickname}"
                                       class="link-light"
                                       style="text-decoration: none;">
                                        닉네임
                                    </a>
                                </span>
                            </td>

                            <td>
                                <span class="badge rounded-pill badge-sn">
                                    <a th:href="'https://stats.csonline.nexon.com/record/match/list?player=' + ${user.userKey}"
                                       th:text="${user.userKey}"
                                       target="_blank"
                                       rel="noopener noreferrer">
                                        nexonsn
                                    </a>
                                </span>
                            </td>
                        </tr>
                        </tbody>
                    </table>
                </div>

                <!-- 페이지네이션 -->
                <nav th:if="${totalPages > 1}" class="mt-3">
                    <ul class="pagination justify-content-center mb-0">

                        <!-- 이전 -->
                        <li class="page-item" th:classappend="${pageNumber == 0} ? ' disabled'">
                            <a class="page-link"
                               th:href="@{/getUser(page=${pageNumber - 1}, size=${size})}"
                               aria-label="Previous">
                                <span aria-hidden="true">«</span>
                            </a>
                        </li>

                        <!-- 페이지 번호들 -->
                        <li class="page-item"
                            th:each="i : ${#numbers.sequence(0, totalPages - 1)}"
                            th:classappend="${i == pageNumber} ? ' active'">
                            <a class="page-link"
                               th:href="@{/getUser(page=${i}, size=${size})}"
                               th:text="${i + 1}">1</a>
                        </li>

                        <!-- 다음 -->
                        <li class="page-item"
                            th:classappend="${pageNumber + 1 >= totalPages} ? ' disabled'">
                            <a class="page-link"
                               th:href="@{/getUser(page=${pageNumber + 1}, size=${size})}"
                               aria-label="Next">
                                <span aria-hidden="true">»</span>
                            </a>
                        </li>

                    </ul>
                </nav>

            </div>

        </div>
    </div>

</div>

</body>
</html>
